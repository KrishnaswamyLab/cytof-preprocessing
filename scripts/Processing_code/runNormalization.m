addpath('../Normalization/Source');
addpath('../Infrastructure/Source');
addpath('../export_fig')

filenames = { ...  
            '162024 ZIKV MOI 5_10Jan2017_01.FCS', ...
            '162024 MOCK_10Jan2017_01.FCS',...
            'NYC102516 ZIKV MOI 5_10Jan2017_01.FCS',...
            'NYC102516 MOCK_10Jan2017_01.FCS' ...
%             '110164_DENV-MOI 5_14Oct2016_01.FCS', ...    
%             '110164_Mock-DENV_14Oct2016_01.FCS', ...
%             '110164_Mock_14Oct2016_01.FCS', ...
%             '110164_ZIKV-MOI 1_14Oct2016_01.FCS', ...
%             '110164_ZIKV-MOI 5_14Oct2016_01.FCS', ...
%             'NY110315_DENV-MOI 5_14Oct2016_01.FCS', ...
%             'NY110315_Mock-DENV_14Oct2016_01.FCS', ...
%             'NY110315_Mock_14Oct2016_01.FCS', ...
%             'NY110315_Mock_14Oct2016_02.FCS', ...
%             'NY110315_Mock_14Oct2016_03.FCS', ...
%             'NY110315_Mock_14Oct2016_04.FCS', ...
%             'NY110315_ZIKV-MOI 1_14Oct2016_03.FCS', ...
%             'NY110315_ZIKV-MOI 1_14Oct2016_04.FCS', ...
%             'NY110315_ZIKV-MOI 5_14Oct2016_04.FCS', ...
%             'NY110315_ZIKV-MOI 5_14Oct2016_05.FCS' ...

            };
prefixes = { ... 
            '162024 ZIKV MOI 5_10Jan2017_01', ...
            '162024 MOCK_10Jan2017_01',...
            'NYC102516 ZIKV MOI 5_10Jan2017_01',...
            'NYC102516 MOCK_10Jan2017_01' ...
%             '110164_DENV-MOI 5_14Oct2016_01', ...    
%             '110164_Mock-DENV_14Oct2016_01', ...
%             '110164_Mock_14Oct2016_01', ...
%             '110164_ZIKV-MOI 1_14Oct2016_01', ...
%             '110164_ZIKV-MOI 5_14Oct2016_01', ...
%             'NY110315_DENV-MOI 5_14Oct2016_01', ...
%             'NY110315_Mock-DENV_14Oct2016_01', ...
%             'NY110315_Mock_14Oct2016_01', ...
%             'NY110315_Mock_14Oct2016_02', ...
%             'NY110315_Mock_14Oct2016_03', ...
%             'NY110315_Mock_14Oct2016_04', ...
%             'NY110315_ZIKV-MOI 1_14Oct2016_03', ...
%             'NY110315_ZIKV-MOI 1_14Oct2016_04', ...
%             'NY110315_ZIKV-MOI 5_14Oct2016_04', ...
%             'NY110315_ZIKV-MOI 5_14Oct2016_05' ...
%                 'singled_gated_Marrow1_01_Basal1' ...

           };
%%
for i=1:size(filenames, 2)
    options = OptionsNormalization();
    options.emitPlots = true;
    options.plotOutputFolder = 'PlotsNormalization';
    options.emitNormalizedData = true;
    options.dataOutputFolder = 'DerivedData';
    options.expId = '0';
%     options.method = 'splorm';
    options.method='standard';
    options.prefix = prefixes{i};
    options.automaticMassToChannelMap = true;
%     options.beadChannelNames={
%     options.beadStandard='1El';
%     options.beadChannelNames = {'Eu151Di', 'Eu153Di'};
    options.beadChannelNames = {'Ce140Di', 'Nd142Di', 'Eu151Di', 'Eu153Di', 'Ho165Di', 'Lu175Di'};
%     options.beadChannelNames = {'Ce140Di', 'Ce142Di', 'Eu151Di', 'Eu153Di', 'Ho165Di', 'Lu175Di', 'Lu176Di'};
    %options.dNA1ChannelName = 'dna1';
    if i>10
        data{i} = NormalizationCyTOFData(['../xiaomei_10Jan2017/xiaomei_10Jan2017/' filenames{i}], options);
    else
        data{i} = NormalizationCyTOFData(['../xiaomei_10Jan2017/xiaomei_10Jan2017/' filenames{i}], options);
    end
    
    data{i} = data{i}.populateBeadIndices();
    data{i} = data{i}.populateBeadValues();
    pause(10);
    close all;
end

allBeadValues = [];
for i=1:size(filenames, 2)
    allBeadValues = [ allBeadValues ; data{i}.beadValues ];
end
beadMedianOverall = median(allBeadValues);

for i=1:size(filenames, 2)
    data{i}.options.beadMedians = beadMedianOverall;
    data{i} = normalize(data{i});
    pause(10);
    close all;
end
